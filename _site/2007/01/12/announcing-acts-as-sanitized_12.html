<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="The online writing of Alex Payne" name="description">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.0/css/bulma.min.css" type="text/css">
  <link rel="stylesheet" href="/css/screen.css" type="text/css">
  <link rel="alternate" type="application/atom+xml" title="Alex Payne" href="/atom.xml">
  <link rel="canonical" href="http://localhost:3000/2007/01/12/announcing-acts-as-sanitized_12.html"/>
  <script src="/js/helpers.js"></script>
  <title>Alex Payne &mdash; Announcing Acts As Sanitized</title>
<script src="http://127.0.0.1:35729/livereload.js"></script></head>

<body>
  <nav class="navbar is-dark" role="navigation" aria-label="main navigation">
  <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
        <tt><strong>3</strong></tt>
      </a>
      <button class="button navbar-burger" data-target="navMenu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div class="navbar-menu" id="navMenu">
      <div class="navbar-start">
        <a class="navbar-item" href="/">Home</a>
        <a href="/about.html" class="navbar-item" title="About the author and site">About</a>
        <a href="/archive.html" class="navbar-item" title="Archived writing">Archive</a>
        <a href="/publications.html" class="navbar-item" title="Publications">Publications</a>
        <a href="/events.html" class="navbar-item" title="Events">Events</a>
      </div>
      <div class="navbar-end">
      </div>
    </div>
  </div>
</nav>


  <section class="hero is-light">
  <div class="hero-body">
    <div class="container">
      <h1 class="title">Alex Payne</h1>
      <h2 class="subtitle">
        Writer, backer, erstwhile technologist.
      </h2>
    </div>
  </div>
</section>


  <section class="section main-section">
    <div class="container">
      <div class="columns is-desktop">
        <div class="column is-half is-offset-one-quarter">
          <div class="content">
            <div class="post">
  <h1 id="announcing-acts-as-sanitized">Announcing Acts As Sanitized</h1>

<p>When I was doing my <a href="http://static.al3x.net/securing_rails.pdf">talk on Rails security</a> at RailsConf Europe I joked about delivering a magical plugin, <code class="highlighter-rouge">acts_as_impenetrable</code>, that solved all of your security needs. There’s still no magic bullet for security, but I’d like to contribute a smidge of code that brings us a step closer.</p>

<p>Rails has the ability to mitigate <a href="http://en.wikipedia.org/wiki/Cross-site_scripting">cross-site scripting attacks</a> in the form of its <a href="http://api.rubyonrails.org/classes/ActionView/Helpers/TextHelper.html#M000516">ActionView::Helpers::TextHelpers#sanitize</a> method. This method won’t catch every clever XSS out there, but it sure helps. Sadly, <code class="highlighter-rouge">sanitize</code> is unavailable by default from your models and controllers; the expected usage pattern is that you’ll handle sanitization in your view, ex: <code class="highlighter-rouge">&lt;%= sanitize(</code>story.title) &gt;@ or <code class="highlighter-rouge">&lt;%=h </code>story.body&gt;@.</p>

<p>I don’t think that’s especially, uh, agile (or whatever). Neither is importing those TextHelpers into your controller and reassigning your models’ various attributes to sanitized versions of themselves before saving. It’s tedious, it’s repetitive, and it opens the door to careless errors. Are you sure that you know <em>every</em> field that gets displayed in your views, even after all those revisions and migrations?</p>

<p>My solution to this is a plugin: <a href="http://code.al3x.net/svn/acts_as_sanitized/">acts_as_sanitized</a>. You use it like so:</p>

<p>class Comment &lt; ActiveRecord::Base
 acts_as_sanitized
 end</p>

<p>That’s it. The plugin figures out which fields in your model are able to be sanitized at application runtime. If you’re not comfortable with that for some strange reason, you can also specify which fields you’d like sanitized. You can even tell it to strip all tags, not just the ones that the <code class="highlighter-rouge">sanitize</code> method in Rails handles (<code class="highlighter-rouge">script</code> and <code class="highlighter-rouge">form</code>). Plus no more monkeying around in your controllers, no more wasteful filtering in your views.
Install like so from the root directory of your Rails app:</p>

<p>script/plugin install http://code.al3x.net/svn/acts_as_sanitized/</p>

<p>Documentation is included in the README file, and there’s a decent suite of tests included.</p>

<p>There isn’t much to this plugin as it stands, but as XSS attacks become ever-more complicated, I’m hoping that this plugin evolves to detect and combat them. If you see attacks that are sneaking by <code class="highlighter-rouge">sanitize</code> and <code class="highlighter-rouge">strip_tags</code>, let me know! Bugs and patches are more than welcome.</p>

  <time class="is-pulled-right" datetime="2007-01-12">
    &mdash; January 12, 2007
  </time>
</div>

          </div>
        </div>
      </div>
    </div>
  </section>

  <footer class="footer">
  <div class="container">
    <div class="content">
      &copy; 2017 Alex Payne
      &middot;
      <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND</a>
    </div>
  </div>
</footer>

  
</body>

</html>
